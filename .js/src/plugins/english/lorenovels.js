var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(t){o(t)}}function s(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),n=require("@libs/fetch"),i=function(){function i(){this.id="lorenovels",this.name="Lore Novels",this.icon="src/en/lorenovels/icon.png",this.site="https://lorenovels.com",this.version="1.0.3"}return i.prototype.resolvePath=function(t){if(t){if(t.startsWith("http")){var e=new URL(t);if(!e.hostname.endsWith("lorenovels.com"))return;return e.pathname}return t.startsWith("/")?t:"/".concat(t)}},i.prototype.resolveCover=function(t){if(t&&!t.startsWith("data:"))return t.startsWith("http")?t:new URL(t,this.site).toString()},i.prototype.parseHomeNovels=function(t){var e=this,r=t("div.entry-content.alignwide.wp-block-post-content").first(),n=r.length?r:t.root(),i=[],o=new Set;return n.find("div.wp-block-column").each((function(r,n){var a=t(n),s=a.find("h2 a").first().attr("href"),c=a.find("h2 a").first().text().trim(),h=a.find("figure img").first(),u=e.resolveCover(h.attr("data-src")||h.attr("src")),l=e.resolvePath(s);c&&l&&!o.has(l)&&(o.add(l),i.push({name:c,path:l,cover:u}))})),i},i.prototype.popularNovels=function(i,o){return t(this,arguments,void 0,(function(t,i){var o,a;i.showLatestNovels;return e(this,(function(e){switch(e.label){case 0:return t>1?[2,[]]:[4,(0,n.fetchApi)(this.site).then((function(t){return t.text()}))];case 1:return o=e.sent(),a=(0,r.load)(o),[2,this.parseHomeNovels(a)]}}))}))},i.prototype.parseNovel=function(i){return t(this,void 0,void 0,(function(){var t,o,a,s,c,h,u,l,f,p,d,v,m,w,b,y,g,x,k,_=this;return e(this,(function(e){switch(e.label){case 0:return[4,(0,n.fetchApi)(this.site+i).then((function(t){return t.text()}))];case 1:return t=e.sent(),o=(0,r.load)(t),a=o("h1.entry-title, h1.wp-block-post-title, h1").first().text().trim(),s=o("div.entry-content figure.wp-block-image img").first(),c=o('div.entry-content img[class*="wp-image-"]').first(),h=o("img.wp-post-image").first(),u=o(".wp-block-image img").first(),l=o("figure img").first(),f=o("div.entry-content img").first(),p=this.resolveCover(s.attr("data-src")||s.attr("src")||c.attr("data-src")||c.attr("src")||h.attr("data-src")||h.attr("src")||u.attr("data-src")||u.attr("src")||l.attr("data-src")||l.attr("src")||f.attr("data-src")||f.attr("src")),d=["title:","author:","genre:","genres:","status:","artist:"],o("div.wp-block-group.is-vertical").each((function(t,e){var r=o(e),n=r.find("p").first().text().trim().toLowerCase();if(d.includes(n)){var i=r.find("h2").first().text().trim()||r.find(".wp-block-button__link").first().text().trim();i&&("title:"===n?a&&"Untitled"!==a||(a=i):"author:"===n?v=i:"genre:"===n||"genres:"===n?m=i:"status:"===n?w=i:"artist:"===n&&(b=i))}})),y=[],o("div.entry-content p").each((function(t,e){var r=o(e).text().trim();r&&(d.includes(r.toLowerCase())||y.push(r))})),g=y.join("\n\n")||void 0,x=[],k=new Set,o(".wp-block-latest-posts__post-title").each((function(t,e){var r=o(e),n=r.attr("href"),i=_.resolvePath(n),a=r.text().trim();i&&a&&!k.has(i)&&(k.add(i),x.push({name:a,path:i}))})),o("div.entry-content a:not(.wp-block-button__link)").each((function(t,e){var r=o(e),n=r.attr("href"),i=_.resolvePath(n),a=r.text().trim();i&&a&&(i.includes("#")||i.includes("/wp-content/")||(/chapter|cap|ch\.?\s?\d/i.test(a)||/chapter/i.test(i))&&(k.has(i)||(k.add(i),x.push({name:a,path:i}))))})),[2,{path:i,name:a||"Untitled",cover:p,summary:g,author:v,artist:b,genres:m,status:w,chapters:x}]}}))}))},i.prototype.parseChapter=function(i){return t(this,void 0,void 0,(function(){var t,o,a,s;return e(this,(function(e){switch(e.label){case 0:return[4,(0,n.fetchApi)(this.site+i).then((function(t){return t.text()}))];case 1:return t=e.sent(),o=(0,r.load)(t),a=o("h1.wp-block-post-title").text().trim(),o("script, style, .sharedaddy, .wp-block-buttons, nav, form, .comment-respond, .not-a-member-block, .site-comments, .wp-block-post-navigation-link").remove(),o("div.entry-content img").each((function(t,e){var r=o(e),n=r.attr("data-src");n&&(r.attr("src",n),r.removeAttr("data-src"))})),s=o("div.entry-content").html()||"",[2,"<h1>".concat(a,"</h1>\n").concat(s)]}}))}))},i.prototype.searchNovels=function(i,o){return t(this,void 0,void 0,(function(){var t,a,s,c,h,u=this;return e(this,(function(e){switch(e.label){case 0:return o>1?[2,[]]:(t="".concat(this.site,"/?s=").concat(encodeURIComponent(i)),[4,(0,n.fetchApi)(t).then((function(t){return t.text()}))]);case 1:return a=e.sent(),s=(0,r.load)(a),c=[],h=new Set,s("article").each((function(t,e){var r=s(e),n=r.find("h2 a, h1 a").first().attr("href"),i=r.find("h2, h1").first().text().trim(),o=r.find("img").first(),a=u.resolveCover(o.attr("data-src")||o.attr("src")),l=u.resolvePath(n);i&&l&&!h.has(l)&&(/chapter|cap|ch\.?\s?\d/i.test(i)||(h.add(l),c.push({name:i,path:l,cover:a})))})),c.length?[2,c]:[2,this.parseHomeNovels(s)]}}))}))},i}();exports.default=new i;