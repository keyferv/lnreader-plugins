var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),n=require("@libs/fetch"),o=function(){function o(){this.id="lorenovels",this.name="Lore Novels",this.icon="src/en/lorenovels/icon.svg",this.site="https://lorenovels.com",this.version="1.0.0"}return o.prototype.resolvePath=function(t){if(t){if(t.startsWith("http")){var e=new URL(t);if(!e.hostname.endsWith("lorenovels.com"))return;return e.pathname}return t.startsWith("/")?t:"/".concat(t)}},o.prototype.resolveCover=function(t){if(t)return t.startsWith("http")?t:new URL(t,this.site).toString()},o.prototype.parseHomeNovels=function(t){var e=this,r=t("div.entry-content.alignwide.wp-block-post-content").first(),n=r.length?r:t,o=[],i=new Set;return n.find("div.wp-block-column").each((function(r,n){var s=t(n),a=s.find("h2 a").first().attr("href"),c=s.find("h2 a").first().text().trim(),h=e.resolveCover(s.find("figure img").attr("src")),u=e.resolvePath(a);c&&u&&!i.has(u)&&(i.add(u),o.push({name:c,path:u,cover:h}))})),o},o.prototype.popularNovels=function(o,i){return t(this,arguments,void 0,(function(t,o){var i,s;return o.showLatestNovels,e(this,(function(e){switch(e.label){case 0:return t>1?[2,[]]:[4,(0,n.fetchApi)(this.site).then((function(t){return t.text()}))];case 1:return i=e.sent(),s=(0,r.load)(i),[2,this.parseHomeNovels(s)]}}))}))},o.prototype.parseNovel=function(o){return t(this,void 0,void 0,(function(){var t,i,s,a,c,h,u,l=this;return e(this,(function(e){switch(e.label){case 0:return[4,(0,n.fetchApi)(this.site+o).then((function(t){return t.text()}))];case 1:return t=e.sent(),i=(0,r.load)(t),s=i("h1.entry-title, h1.wp-block-post-title, h1").first().text().trim(),a=this.resolveCover(i("img.wp-post-image").first().attr("src")||i(".wp-block-image img").first().attr("src")||i("figure img").first().attr("src")),c=i("div.entry-content p").map((function(t,e){return i(e).text().trim()})).get().filter(Boolean).shift(),h=[],u=new Set,i("div.entry-content a").each((function(t,e){var r=i(e),n=r.attr("href"),o=l.resolvePath(n),s=r.text().trim();o&&s&&(o.includes("#")||o.includes("/wp-content/")||(/chapter|cap|ch\.?\s?\d/i.test(s)||/chapter/i.test(o))&&(u.has(o)||(u.add(o),h.push({name:s,path:o}))))})),[2,{path:o,name:s||"Untitled",cover:a,summary:c,chapters:h}]}}))}))},o.prototype.parseChapter=function(o){return t(this,void 0,void 0,(function(){var t,i;return e(this,(function(e){switch(e.label){case 0:return[4,(0,n.fetchApi)(this.site+o).then((function(t){return t.text()}))];case 1:return t=e.sent(),(i=(0,r.load)(t))("script, style, .sharedaddy, .wp-block-buttons, nav, form, .comment-respond").remove(),[2,i("div.entry-content").html()||""]}}))}))},o.prototype.searchNovels=function(o,i){return t(this,void 0,void 0,(function(){var t,s,a,c,h,u=this;return e(this,(function(e){switch(e.label){case 0:return i>1?[2,[]]:(t="".concat(this.site,"/?s=").concat(encodeURIComponent(o)),[4,(0,n.fetchApi)(t).then((function(t){return t.text()}))]);case 1:return s=e.sent(),a=(0,r.load)(s),c=[],h=new Set,a("article").each((function(t,e){var r=a(e),n=r.find("h2 a, h1 a").first().attr("href"),o=r.find("h2, h1").first().text().trim(),i=u.resolveCover(r.find("img").first().attr("src")),s=u.resolvePath(n);o&&s&&!h.has(s)&&(/chapter|cap|ch\.?\s?\d/i.test(o)||(h.add(s),c.push({name:o,path:s,cover:i})))})),c.length?[2,c]:[2,this.parseHomeNovels(a)]}}))}))},o}();exports.default=new o;