var e=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(n,i){function l(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,o)}s((r=r.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,r,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=o(0),l.throw=o(1),l.return=o(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function o(o){return function(s){return function(o){if(a)throw new TypeError("Generator is already executing.");for(;l&&(l=0,o[0]&&(i=0)),i;)try{if(a=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{a=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("cheerio"),r=require("@libs/fetch"),n=require("@libs/filterInputs");function i(e){return(e||"").replace(/\s+/g," ").trim()}function l(e,t){if(t){var a=e(t);return a.attr("data-lazy-src")||a.attr("data-src")||a.attr("data-original")||a.attr("src")||void 0}}function o(e,t){try{return new URL(t,e).toString()}catch(e){return t}}function s(e,t){var a=e.replace(/\/$/,"");return t.replace(a,"").replace(/^\//,"")}var c=function(){function c(){this.id="novelasligerasnet",this.name="Novelas Ligeras (net)",this.icon="src/es/novelasligerasnet/icon.png",this.site="https://novelasligeras.net/",this.version="1.0.1",this.filters={category:{type:n.FilterTypes.Picker,label:"Categoría",value:"",options:[{label:"Cualquiera",value:""},{label:"Acción",value:"40"},{label:"Adulto",value:"53"},{label:"Artes Marciales",value:"52"},{label:"Aventura",value:"41"},{label:"Ciencia Ficción",value:"59"},{label:"Comedia",value:"43"},{label:"Deportes",value:"68"},{label:"Drama",value:"44"},{label:"Ecchi",value:"45"},{label:"Fantasía",value:"46"},{label:"Gender Bender",value:"47"},{label:"Harem",value:"48"},{label:"Histórico",value:"49"},{label:"Horror",value:"50"},{label:"Josei",value:"51"},{label:"Mechas",value:"54"},{label:"Misterio",value:"55"},{label:"Psicológico",value:"56"},{label:"Recuentos de la Vida",value:"66"},{label:"Romance",value:"57"},{label:"Seinen",value:"60"},{label:"Shojo",value:"62"},{label:"Shojo Ai",value:"63"},{label:"Shonen",value:"64"},{label:"Smut",value:"67"},{label:"Sobrenatural",value:"69"},{label:"Tragedia",value:"70"},{label:"Vida Escolar",value:"58"},{label:"Xianxia",value:"72"},{label:"Xuanhuan",value:"73"},{label:"Yuri",value:"75"}]},status:{type:n.FilterTypes.Picker,label:"Estado",value:"",options:[{label:"Cualquiera",value:""},{label:"Cancelado",value:"18"},{label:"Completado",value:"407"},{label:"En Proceso",value:"16"},{label:"Pausado",value:"17"}]},type:{type:n.FilterTypes.Picker,label:"Tipo",value:"",options:[{label:"Cualquiera",value:""},{label:"Novela Ligera",value:"23"},{label:"Novela Web",value:"24"}]},country:{type:n.FilterTypes.Picker,label:"País",value:"",options:[{label:"Cualquiera",value:""},{label:"China",value:"20"},{label:"Corea",value:"22"},{label:"Japón",value:"21"}]}}}return c.prototype.resolveUrl=function(e){try{return new URL(e,this.site).toString()}catch(t){return e}},c.prototype.getDocument=function(n){return e(this,void 0,void 0,(function(){var e,i;return t(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchApi)(n,{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"es-ES,es;q=0.9,en;q=0.8"}})];case 1:if(!(e=t.sent()).ok)throw new Error("Could not reach site (".concat(e.status,"). If this is Cloudflare-protected, open in webview or provide cookies (cf_clearance) in Settings."));return[4,e.text()];case 2:return i=t.sent(),[2,(0,a.load)(i)]}}))}))},c.prototype.extractNovelCandidates=function(e,t){var a=this;void 0===t&&(t={});var r=[],n=new Set,c=t.max||30,u=function(e,t,l){var c=o(a.site,t),u=s(a.site,c);if(u&&!n.has(u)){var h=i(e);h&&(n.add(u),r.push({name:h,path:u,cover:l}))}},h=function(e){var t=e.toLowerCase();return!t.includes("wp-login")&&!t.includes("wp-admin")&&(!(t.includes("#")||t.startsWith("javascript:")||t.startsWith("data:")||t.startsWith("vbscript:"))&&(!t.includes("mailto:")&&!t.includes("tel:")&&(!t.includes("/category/")&&!t.includes("/tag/")&&(!t.includes("/feed/")&&!t.includes("rss")&&(t.includes("/producto/")||t.includes("/product/")||t.includes("novela")||t.includes("novel")||t.includes("serie")||t.includes("series"))))))};if(e(".dt-css-grid .wf-cell").each((function(t,r){var n=e(r).find("h4.entry-title a[href]").first(),s=n.attr("href");if(s){var c=o(a.site,s);if(c.includes("novelasligeras.net")&&h(c)){var v=i(e(r).attr("data-name"))||i(n.text())||i(n.attr("title")),p=l(e,e(r).find("img.attachment-woocommerce_thumbnail")[0])||l(e,e(r).find("figure.woocom-project img")[0])||void 0;u(v,c,p)}}})),r.length)return r.slice(0,c);for(var v=0,p=["article h2 a[href]","article h3 a[href]","article h4 a[href]","h4.entry-title a[href]",".entry-content a[href]","main a[href]"];v<p.length;v++){if(e(p[v]).each((function(t,r){var n=e(r).attr("href");if(n){var s=o(a.site,n);if(s.includes("novelasligeras.net")&&h(s)){var c=i(e(r).text())||i(e(r).attr("title")),v=l(e,e(r).find("img")[0])||l(e,e(r).closest("article").find("img")[0]);u(c,s,v)}}})),r.length>=c)break}return r.slice(0,c)},c.prototype.popularNovels=function(a,r){return e(this,arguments,void 0,(function(e,a){var r,n,i,l,o,s,c,u,h,v,p=a.showLatestNovels,f=a.filters;return t(this,(function(t){switch(t.label){case 0:return r=this.site+"index.php/lista-de-novela-ligera-novela-web/",(n=new URLSearchParams).set("paged",String(e)),p||n.set("orderby","popularity"),f&&((null===(c=f.category)||void 0===c?void 0:c.value)&&n.set("product-search-filter-product_cat",f.category.value),(null===(u=f.status)||void 0===u?void 0:u.value)&&n.set("product-search-filter-pa_estado",f.status.value),(null===(h=f.type)||void 0===h?void 0:h.value)&&n.set("product-search-filter-pa_tipo",f.type.value),(null===(v=f.country)||void 0===v?void 0:v.value)&&n.set("product-search-filter-pa_pais",f.country.value)),i="".concat(r,"?").concat(n.toString()),[4,this.getDocument(i)];case 1:return l=t.sent(),(o=this.extractNovelCandidates(l,{max:30})).length?[3,3]:[4,this.getDocument(this.site)];case 2:return s=t.sent(),[2,this.extractNovelCandidates(s,{max:30})];case 3:return[2,o]}}))}))},c.prototype.searchNovels=function(a,r){return e(this,void 0,void 0,(function(){var e,n,c,u,h,v=this;return t(this,(function(t){switch(t.label){case 0:return(e=new URLSearchParams).set("s",a),e.set("post_type","product"),e.set("paged",String(r)),n="".concat(this.site,"?").concat(e.toString()),[4,this.getDocument(n)];case 1:return c=t.sent(),u=[],h=new Set,c("article").each((function(e,t){var a=c(t).find("h2 a[href], h3 a[href], h4 a[href]").first(),r=a.attr("href");if(r){var n=o(v.site,r),p=s(v.site,n);if(p&&!h.has(p)){var f=i(a.text())||i(a.attr("title"));if(f){var d=l(c,c(t).find("img")[0])||c(t).find('meta[property="og:image"]').attr("content")||void 0;h.add(p),u.push({name:f,path:p,cover:d})}}}})),u.length?[2,u]:[2,this.extractNovelCandidates(c,{max:30})]}}))}))},c.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,r,n,c,u,h,v,p,f,d,b,m,g,y,w,x=this;return t(this,(function(t){switch(t.label){case 0:return e=this.resolveUrl(a),[4,this.getDocument(e)];case 1:for(r=t.sent(),n=i(r("h1.entry-title").first().text())||i(r("h1").first().text())||i(r('meta[property="og:title"]').attr("content"))||a,c=r('meta[property="og:image"]').attr("content")||l(r,r("img.wp-post-image")[0])||l(r,r("article img")[0])||void 0,u=i(r('meta[property="og:description"]').attr("content"))||i(r("article .entry-content p").slice(0,5).toArray().map((function(e){return r(e).text()})).join("\n"))||i(r(".entry-content").text()),h={name:n,path:a,cover:c,summary:u},v=i(r("article").text()),(null==(p=v.match(/Autor\s*:?\s*([^\n\r]+)/i))?void 0:p[1])&&(h.author=i(p[1])),(null==(f=v.match(/Estado\s*:?\s*([^\n\r]+)/i))?void 0:f[1])&&(h.status=i(f[1])),d=[],b=function(e){var t=e.toLowerCase();return!!t.includes("novelasligeras.net")&&(!(t.includes("#")||t.startsWith("javascript:")||t.startsWith("data:")||t.startsWith("vbscript:"))&&(/\/index\.php\/20\d{2}\/\d{2}\/\d{2}\//.test(t)||t.includes("-cap-")||t.includes("/cap-")||t.includes("capitulo")||t.includes("cap")||t.includes("chapter")||t.includes("epis")))},m=0,g=[".wp-manga-chapter a[href]",".chapter-list a[href]",".chapters a[href]",".woocommerce-product-details__short-description a[href]",".entry-summary a[href]","ol li a[href]","ul li a[href]"];m<g.length&&(r(g[m]).each((function(e,t){var a=r(t).attr("href");if(a){var n=o(x.site,a);if(b(n)){var l=i(r(t).text())||i(r(t).attr("title"));l&&d.push({name:l,href:n})}}})),!d.length);m++);return d.length||r(".entry-content a[href]").each((function(e,t){var a=r(t).attr("href");if(a){var n=o(x.site,a);if(b(n)){var l=i(r(t).text())||i(r(t).attr("title"));l&&d.push({name:l,href:n})}}})),d.length||r("a[href]").each((function(e,t){var a=r(t).attr("href");if(a){var n=o(x.site,a);if(b(n)){var l=i(r(t).text())||i(r(t).attr("title"));l&&d.push({name:l,href:n})}}})),y=new Set,w=[],d.forEach((function(e,t){var a=s(x.site,e.href);a&&!y.has(a)&&(y.add(a),w.push({name:e.name,path:a,chapterNumber:t+1,releaseTime:null}))})),w.length&&(h.chapters=w),[2,h]}}))}))},c.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e,r,n,l,o;return t(this,(function(t){switch(t.label){case 0:return e=this.resolveUrl(a),[4,this.getDocument(e)];case 1:for((r=t.sent())("script, style, noscript, iframe").remove(),r(".ads, .ad, .advertisement, .sharedaddy, .wp-block-buttons").remove(),r("header, nav, footer").remove(),n=0,l=["#chapter-content",".reading-content",".entry-content","article","main"];n<l.length;n++)if((o=r(l[n]).first().html())&&i(o).length>50)return[2,o];return[2,r(".entry-content").html()||""]}}))}))},c}();exports.default=new c;