var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(t){o(t)}}function l(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,l)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&l[0]?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,n=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){o.label=l[1];break}if(6===l[0]&&o.label<i[1]){o.label=i[1],i=l;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(l);break}i[2]&&o.ops.pop(),o.trys.pop();continue}l=e.call(t,o)}catch(t){l=[6,t],n=0}finally{r=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},r=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("@libs/fetch"),i=require("@libs/filterInputs"),o=function(){function o(){this.id="ichijoutranslations",this.name="Ichijou Translations",this.site="https://www.ichijoutranslations.com",this.apiSite="https://api.ichijoutranslations.com/api",this.apiRoot="https://api.ichijoutranslations.com",this.cdnSite="https://cdn.ichijoutranslations.com",this.apiHomeBase="https://api.ichijoutranslations.com/api/home",this.version="1.1.5",this.icon="src/es/ichijoutranslations/icon.png",this.lang="Spanish",this.filters={sortBy:{type:i.FilterTypes.Picker,label:"Ordenar por",value:"title",options:[{label:"Título",value:"title"},{label:"Agregado",value:"createdAt"},{label:"Actualizado",value:"updatedAt"},{label:"Vistas",value:"views"}]},sortOrder:{type:i.FilterTypes.Picker,label:"Orden",value:"ASC",options:[{label:"Ascendente",value:"ASC"},{label:"Descendente",value:"DESC"}]}}}return o.prototype.buildCdnUrl=function(t){return t.startsWith("http")?t:this.cdnSite+(t.startsWith("/")?t:"/".concat(t))},o.prototype.buildPdfReaderPath=function(t){var e=this.normalizeApiPath(t);return e.startsWith("/leer-pdf/")?e:"/leer-pdf".concat(e)},o.prototype.normalizeApiPath=function(t){var e=t.replace(/^https?:\/\/[^/]+/i,"");return e.startsWith("/")?e:"/".concat(e)},o.prototype.isPdfFile=function(t){return/\.pdf(\?|$)/i.test(t)},o.prototype.buildChapterPdfPath=function(t){var e=this.normalizeApiPath(t),r=e.split("?"),n=r[0],i=r[1],o=n.split("/").pop();if(!o)return this.buildPdfReaderPath(e);var a=i?"?".concat(i):"";return"/leer-pdf/chapter-files/".concat(o).concat(a)},o.prototype.popularNovels=function(r,i){return t(this,arguments,void 0,(function(t,r){var i,o,a,l,c,s,u,d=this,p=r.filters;return e(this,(function(e){switch(e.label){case 0:return i=(null===(s=null==p?void 0:p.sortBy)||void 0===s?void 0:s.value)||this.filters.sortBy.value,o=(null===(u=null==p?void 0:p.sortOrder)||void 0===u?void 0:u.value)||this.filters.sortOrder.value,a="".concat(this.apiSite,"/home/explore?page=").concat(t,"&limit=12&sortBy=").concat(i,"&sortOrder=").concat(o),[4,(0,n.fetchApi)(a)];case 1:return[4,e.sent().json()];case 2:return l=e.sent(),c=[],l.data.data.forEach((function(t){var e=t.workImages.find((function(t){return"card"===t.image_type.code&&t.image_url}))||t.workImages.find((function(t){return"cover"===t.image_type.code&&t.image_url})),r=(null==e?void 0:e.image_url)?d.buildCdnUrl(e.image_url):void 0;c.push({name:t.title,cover:r,path:"/obras/".concat(t.id,"-").concat(t.slug)})})),[2,c]}}))}))},o.prototype.parseNovel=function(i){return t(this,void 0,void 0,(function(){var t,o,a,l,c,s,u,d,p,h,f,v,m,y,b,g,w,_,x,A,P,I,j,k,S,C,O,E,N;return e(this,(function(e){switch(e.label){case 0:if(!(t=i.split("/").pop()))throw new Error("No se pudo obtener el slug de la novela");return o="".concat(this.apiHomeBase,"/works/").concat(t),[4,(0,n.fetchApi)(o)];case 1:return[4,e.sent().json()];case 2:if(a=e.sent(),l=a.data,c=null!==(j=null===(I=l.workImages)||void 0===I?void 0:I.find((function(t){return"card"===t.image_type.code&&t.image_url})))&&void 0!==j?j:null===(k=l.workImages)||void 0===k?void 0:k.find((function(t){return"cover"===t.image_type.code&&t.image_url})),s=(null==c?void 0:c.image_url)?this.buildCdnUrl(c.image_url):void 0,u=(null===(S=l.workGenres)||void 0===S?void 0:S.map((function(t){return t.genre.name})))||[],d=[],p=0,(h=Array.isArray(l.volumes)?l.volumes:[]).length)for(f=r([],h,!0).sort((function(t,e){return t.orderIndex-e.orderIndex})),v=0,m=f;v<m.length;v++)y=m[v],(A=y.fileUrl||(null===(C=y.volume_file)||void 0===C?void 0:C.fileUrl))&&this.isPdfFile(A)&&(p++,d.push({name:"Volumen ".concat(y.orderIndex,": ").concat(y.title),path:this.buildPdfReaderPath(A),releaseTime:y.createdAt,chapterNumber:p}));if((b=Array.isArray(l.chapters)?l.chapters:[]).length)for(g=r([],b,!0).sort((function(t,e){return t.orderIndex-e.orderIndex})),w=0,_=g;w<_.length;w++)x=_[w],p++,A=x.fileUrl||(null===(O=x.chapterFile)||void 0===O?void 0:O.fileUrl),P=A&&this.isPdfFile(A)?this.buildChapterPdfPath(A):null,d.push({name:"Capítulo ".concat(x.orderIndex,": ").concat(x.title),path:null!=P?P:"/capitulo/".concat(x.id),releaseTime:x.createdAt,chapterNumber:p});return[2,{path:i,name:l.title,cover:s,summary:l.synopsis,status:null===(N=null===(E=l.publicationStatus)||void 0===E?void 0:E.name)||void 0===N?void 0:N.trim(),genres:u.join(", "),chapters:d}]}}))}))},o.prototype.parseChapter=function(r){return t(this,void 0,void 0,(function(){var t,i,o,a,l,c,s,u,d,p,h,f,v,m,y,b,g,w,_,x;return e(this,(function(e){switch(e.label){case 0:if(r.includes("/leer-pdf/"))return t=r.replace("/leer-pdf",""),i="".concat(this.apiRoot).concat(t),[2,'<div style="text-align:center;padding:32px 16px;font-family:sans-serif;"><p style="font-size:18px;margin-bottom:24px;">Este capítulo está en formato PDF.</p>'+'<a href="'.concat(i,'" style="display:inline-block;padding:14px 28px;')+'background:#1976D2;color:#fff;text-decoration:none;border-radius:8px;font-size:16px;">Abrir PDF</a></div>'];if(!r.startsWith("/capitulo/"))return[3,3];if(!(o=null===(f=null===(h=r.split("/").pop())||void 0===h?void 0:h.match(/^(\d+)/))||void 0===f?void 0:f[1]))throw new Error("No se pudo obtener el ID del capítulo");return a="".concat(this.apiSite,"/home/chapter/").concat(o),[4,(0,n.fetchApi)(a)];case 1:case 4:return[4,e.sent().json()];case 2:if(l=e.sent(),!(c=null!==(y=null!==(m=null===(v=l.data)||void 0===v?void 0:v.content)&&void 0!==m?m:l.content)&&void 0!==y?y:""))throw new Error("No se encontró contenido del capítulo");return[2,c];case 3:if(!(s=null===(g=null===(b=r.split("/").pop())||void 0===b?void 0:b.match(/^(\d+)/))||void 0===g?void 0:g[1]))throw new Error("No se pudo obtener el ID del capítulo");return u="".concat(this.apiSite,"/home/chapter/").concat(s),[4,(0,n.fetchApi)(u)];case 5:if(d=e.sent(),!(p=null!==(x=null!==(_=null===(w=d.data)||void 0===w?void 0:w.content)&&void 0!==_?_:d.content)&&void 0!==x?x:""))throw new Error("No se encontró contenido del capítulo");return[2,p]}}))}))},o.prototype.searchNovels=function(r,i){return t(this,void 0,void 0,(function(){var t,o,a,l,c,s=this;return e(this,(function(e){switch(e.label){case 0:return t=this.filters.sortBy.value,o=this.filters.sortOrder.value,a="".concat(this.apiSite,"/home/explore?page=").concat(i,"&limit=12&sortBy=").concat(t,"&sortOrder=").concat(o,"&search=").concat(encodeURIComponent(r)),[4,(0,n.fetchApi)(a)];case 1:return[4,e.sent().json()];case 2:return l=e.sent(),c=[],l.data.data.forEach((function(t){var e=t.workImages.find((function(t){return"card"===t.image_type.code&&t.image_url}))||t.workImages.find((function(t){return"cover"===t.image_type.code&&t.image_url})),r=(null==e?void 0:e.image_url)?s.buildCdnUrl(e.image_url):void 0;c.push({name:t.title,cover:r,path:"/obras/".concat(t.id,"-").concat(t.slug)})})),[2,c]}}))}))},o}();exports.default=new o;