var t=this&&this.__awaiter||function(t,e,r,a){return new(r||(r=Promise))((function(n,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((a=a.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,a,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,a&&(n=2&s[0]?a.return:s[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,s[1])).done)return n;switch(a=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,a=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){i.label=s[1];break}if(6===s[0]&&i.label<n[1]){i.label=n[1],n=s;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(s);break}n[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],a=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),a=require("@libs/filterInputs"),n=require("cheerio"),i=function(){function i(){this.id="ichijoutranslations",this.name="Ichijou Translations",this.site="https://www.ichijoutranslations.com",this.apiSite="https://api.ichijoutranslations.com/api",this.cdnSite="https://cdn.ichijoutranslations.com",this.apiHomeBase="https://api.ichijoutranslations.com/api/home",this.version="1.0.9",this.icon="src/es/ichijoutranslations/icon.png",this.lang="Spanish",this.filters={sortBy:{type:a.FilterTypes.Picker,label:"Ordenar por",value:"title",options:[{label:"Título",value:"title"},{label:"Agregado",value:"createdAt"},{label:"Actualizado",value:"updatedAt"},{label:"Vistas",value:"views"}]},sortOrder:{type:a.FilterTypes.Picker,label:"Orden",value:"ASC",options:[{label:"Ascendente",value:"ASC"},{label:"Descendente",value:"DESC"}]}}}return i.prototype.buildExploreUrl=function(t,e,r,a){var n="".concat(this.site,"/explorar?page=").concat(t,"&sortBy=").concat(e,"&sortOrder=").concat(r);return a&&(n+="&search=".concat(encodeURIComponent(a))),n},i.prototype.fetchExploreCoverMap=function(a,i,o,s){return t(this,void 0,void 0,(function(){var t,c,l,u,h=this;return e(this,(function(e){switch(e.label){case 0:return t=this.buildExploreUrl(a,i,o,s),[4,(0,r.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return c=e.sent(),l=(0,n.load)(c),u=new Map,l('div.grid.grid-cols-2 article[role="button"], div.grid article').each((function(t,e){var r=l(e),a=r.find("h3").first().text().trim(),n=(r.find("div.relative img").first().length?r.find("div.relative img").first():r.find("img").first()).attr("src");if(a&&n){var i=n;i.startsWith("http")||(i=new URL(i,h.site).toString()),u.set(a,i)}})),[2,u]}}))}))},i.prototype.buildVolumeApiUrl=function(t){var e=t.split("?")[0].match(/obras\/([^/]+)\/volumen\/([^/]+)/);if(!e)throw new Error("La URL no tiene el formato esperado de obra/volumen");var r=e[1],a=e[2];return"".concat(this.apiHomeBase,"/works/").concat(r,"/volumes/").concat(a)},i.prototype.popularNovels=function(a,n){return t(this,arguments,void 0,(function(t,a){var n,i,o,s,c,l,u,h,p=this,d=a.filters;return e(this,(function(e){switch(e.label){case 0:return n=(null===(u=null==d?void 0:d.sortBy)||void 0===u?void 0:u.value)||this.filters.sortBy.value,i=(null===(h=null==d?void 0:d.sortOrder)||void 0===h?void 0:h.value)||this.filters.sortOrder.value,o="".concat(this.apiSite,"/home/explore?page=").concat(t,"&limit=12&sortBy=").concat(n,"&sortOrder=").concat(i),[4,(0,r.fetchApi)(o)];case 1:return[4,e.sent().json()];case 2:return s=e.sent(),[4,this.fetchExploreCoverMap(t,n,i)];case 3:return c=e.sent(),l=[],s.data.data.forEach((function(t){var e=c.get(t.title);if(!e){var r=t.workImages.find((function(t){return"card"===t.image_type.code&&t.image_url}))||t.workImages.find((function(t){return"cover"===t.image_type.code&&t.image_url}));(e=null==r?void 0:r.image_url)&&!e.startsWith("http")&&(e=p.cdnSite+(e.startsWith("/")?e:"/".concat(e)))}l.push({name:t.title,cover:e,path:"/obras/".concat(t.id,"-").concat(t.slug)})})),[2,l]}}))}))},i.prototype.parseNovel=function(a){return t(this,void 0,void 0,(function(){var t,i,o,s,c,l,u,h,p,d,f,v,m,g,b,y,w,x,A,W,_,j,S,N,E,k,U,I,B,O,C,D,P,F,R;return e(this,(function(e){switch(e.label){case 0:if(!(t=null===(C=null===(O=a.split("/").pop())||void 0===O?void 0:O.match(/^(\d+)-/))||void 0===C?void 0:C[1]))throw new Error("No se pudo obtener el ID de la novela");return i="".concat(this.apiSite,"/home/work/").concat(t),[4,(0,r.fetchApi)(i)];case 1:return[4,e.sent().json()];case 2:o=e.sent(),s=o.data,d=!1,e.label=3;case 3:return e.trys.push([3,6,,7]),[4,(0,r.fetchApi)("".concat(this.site).concat(a))];case 4:return[4,e.sent().text()];case 5:return v=e.sent(),m=(0,n.load)(v),c=m("div.flex.flex-wrap.items-center.gap-2 span").first().text().trim(),(g=m("div.space-y-3 p.text-muted-foreground").first().text().trim())&&(h=g),b=m("section.space-y-4").has('h2:contains("Nombres alternativos")').first(),(y=b.find("ul li").map((function(t,e){var r=m(e),a=r.find("span.font-medium").first().text().trim(),n=r.find("span.text-muted-foreground").last().text().trim();return n?a?"".concat(a,": ").concat(n):n:""})).get().filter(Boolean)).length&&(p=y),w=m("section.space-y-4").has('h2:contains("Géneros")').first(),(x=w.find("div.flex.flex-wrap.gap-2 a").map((function(t,e){return m(e).text().trim()})).get().filter(Boolean)).length&&(l=x),A=m("section.space-y-6").has('h2:contains("Capítulos")').first(),W=[],A.find("div.group.flex").each((function(t,e){var r=m(e),a=r.find("span.text-right").first().text().trim(),n=r.find("p").first().text().trim(),i=r.find('a[href*="/capitulo/"]').attr("href")||r.attr("data-href")||r.attr("data-url")||r.attr("data-path")||r.find("[data-href]").attr("data-href")||r.find("[data-url]").attr("data-url")||r.find("[data-path]").attr("data-path");if(n){var o=Number.parseFloat(a.replace(",",".").trim());if(i){var s=i;s.startsWith("http")&&(s=new URL(s).pathname),s.startsWith("/")||(s="/".concat(s)),W.push({name:n,path:s,chapterNumber:Number.isNaN(o)?void 0:o})}}})),W.length&&(u=W),(_=m("div.grid").has('img[src*="/volume-cards/"]').first()).length&&(d=!0,j=[],_.find("div.group").each((function(t,e){var r=m(e),a=r.find("h3").first().text().trim(),n=r.find("div.absolute.top-2.left-2 span").first().text().trim(),i=r.find('a[href*="/obras/"]').attr("href")||r.attr("data-href")||r.attr("data-url")||r.attr("data-path")||r.find("[data-href]").attr("data-href")||r.find("[data-url]").attr("data-url")||r.find("[data-path]").attr("data-path");if(i){var o=i;o.startsWith("http")&&(o=new URL(o).pathname),o.startsWith("/")||(o="/".concat(o));var s=[n,a].filter(Boolean),c=s.length?s.join(" - "):a;j.push({name:c,path:"/pdf".concat(o),page:"pdf",chapterNumber:t+1})}})),j.length&&(f=j)),[3,7];case 6:return e.sent(),c=void 0,l=void 0,u=void 0,h=void 0,p=void 0,d=!1,f=void 0,[3,7];case 7:return S=s.workImages.find((function(t){return"card"===t.image_type.code&&t.image_url}))||s.workImages.find((function(t){return"cover"===t.image_type.code&&t.image_url})),(N=null==S?void 0:S.image_url)&&!N.startsWith("http")&&(N=this.cdnSite+(N.startsWith("/")?N:"/".concat(N))),E=l||(null===(D=s.workGenres)||void 0===D?void 0:D.map((function(t){return t.genre.name})))||[],(null===(P=s.type)||void 0===P?void 0:P.name)&&E.push(s.type.name),k=h||s.synopsis,U=(null==p?void 0:p.length)?"".concat(k,"\n\nNombres alternativos: ").concat(p.join(" | ")):k,I=d?"".concat(U,"\n\nEste título contiene volúmenes en PDF."):U,B={path:a,name:s.title,cover:N,summary:I,status:c||(null===(R=null===(F=s.publicationStatus)||void 0===F?void 0:F.name)||void 0===R?void 0:R.trim()),genres:E.join(", ")},(null==u?void 0:u.length)?B.chapters=u:(null==f?void 0:f.length)?B.chapters=f:s.chapters&&(B.chapters=s.chapters.map((function(t){return{name:"Capítulo ".concat(t.number,": ").concat(t.title),path:"/capitulo/".concat(t.id,"-").concat(t.slug),chapterNumber:t.number}}))),[2,B]}}))}))},i.prototype.parseChapter=function(a){return t(this,void 0,void 0,(function(){var t,i,o,s,c,l,u,h,p,d,f,v,m,g,b,y,w,x;return e(this,(function(e){switch(e.label){case 0:return a.startsWith("/pdf/")?(t=a.replace(/^\/pdf/,""),l="".concat(this.site).concat(t),u=this.buildVolumeApiUrl(l),[4,(0,r.fetchApi)(u,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Referer:this.site}})]):[3,3];case 1:return[4,e.sent().json()];case 2:if(i=e.sent(),!(p=null===(g=null===(m=i.data)||void 0===m?void 0:m.volume)||void 0===g?void 0:g.fileUrl))throw new Error("No se pudo obtener el enlace del PDF");return d=p.startsWith("http")?p:"".concat(this.cdnSite).concat(p),[2,'<p>Este volumen está en PDF:</p><p><a href="'.concat(d,'">').concat(d,"</a></p>")];case 3:return e.trys.push([3,9,,10]),[4,(0,r.fetchApi)("".concat(this.site).concat(a))];case 4:return[4,e.sent().text()];case 5:return o=e.sent(),s=(0,n.load)(o),(c=s('div.flex.flex-wrap.items-center.gap-3 a[href*="/volumen/"]').first().attr("href")||s('a[href*="/volumen/"]').first().attr("href"))?(l=c.startsWith("http")?c:"".concat(this.site).concat(c),u=this.buildVolumeApiUrl(l),[4,(0,r.fetchApi)(u,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Referer:this.site}})]):[3,8];case 6:return[4,e.sent().json()];case 7:if(h=e.sent(),!(p=null===(y=null===(b=h.data)||void 0===b?void 0:b.volume)||void 0===y?void 0:y.fileUrl))throw new Error("No se pudo obtener el enlace del PDF");return d=p.startsWith("http")?p:"".concat(this.cdnSite).concat(p),[2,'<p>Este volumen está en PDF:</p><p><a href="'.concat(d,'">').concat(d,"</a></p>")];case 8:return[3,10];case 9:return e.sent(),[3,10];case 10:if(!(f=null===(x=null===(w=a.split("/").pop())||void 0===w?void 0:w.match(/^(\d+)-/))||void 0===x?void 0:x[1]))throw new Error("No se pudo obtener el ID del capítulo");return v="".concat(this.apiSite,"/home/chapter/").concat(f),[4,(0,r.fetchApi)(v)];case 11:return[4,e.sent().json()];case 12:return[2,e.sent().data.content]}}))}))},i.prototype.searchNovels=function(a,n){return t(this,void 0,void 0,(function(){var t,i,o,s,c,l,u=this;return e(this,(function(e){switch(e.label){case 0:return t=this.filters.sortBy.value,i=this.filters.sortOrder.value,o="".concat(this.apiSite,"/home/explore?page=").concat(n,"&limit=12&sortBy=").concat(t,"&sortOrder=").concat(i,"&search=").concat(encodeURIComponent(a)),[4,(0,r.fetchApi)(o)];case 1:return[4,e.sent().json()];case 2:return s=e.sent(),[4,this.fetchExploreCoverMap(n,t,i,a)];case 3:return c=e.sent(),l=[],s.data.data.forEach((function(t){var e=c.get(t.title);if(!e){var r=t.workImages.find((function(t){return"card"===t.image_type.code&&t.image_url}))||t.workImages.find((function(t){return"cover"===t.image_type.code&&t.image_url}));(e=null==r?void 0:r.image_url)&&!e.startsWith("http")&&(e=u.cdnSite+(e.startsWith("/")?e:"/".concat(e)))}l.push({name:t.title,cover:e,path:"/obras/".concat(t.id,"-").concat(t.slug)})})),[2,l]}}))}))},i}();exports.default=new i;