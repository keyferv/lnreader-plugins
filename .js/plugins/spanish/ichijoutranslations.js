var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function l(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,l)}s((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(s){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&l[0]?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,n=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){o.label=l[1];break}if(6===l[0]&&o.label<i[1]){o.label=i[1],i=l;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(l);break}i[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(e,o)}catch(e){l=[6,e],n=0}finally{r=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},r=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("@libs/fetch"),i=require("@libs/filterInputs"),o=function(){function o(){this.id="ichijoutranslations",this.name="Ichijou Translations",this.site="https://www.ichijoutranslations.com",this.apiSite="https://api.ichijoutranslations.com/api",this.cdnSite="https://cdn.ichijoutranslations.com",this.apiHomeBase="https://api.ichijoutranslations.com/api/home",this.version="1.1.4",this.icon="src/es/ichijoutranslations/icon.png",this.lang="Spanish",this.filters={sortBy:{type:i.FilterTypes.Picker,label:"Ordenar por",value:"title",options:[{label:"Título",value:"title"},{label:"Agregado",value:"createdAt"},{label:"Actualizado",value:"updatedAt"},{label:"Vistas",value:"views"}]},sortOrder:{type:i.FilterTypes.Picker,label:"Orden",value:"ASC",options:[{label:"Ascendente",value:"ASC"},{label:"Descendente",value:"DESC"}]}}}return o.prototype.buildCdnUrl=function(e){return e.startsWith("http")?e:this.cdnSite+(e.startsWith("/")?e:"/".concat(e))},o.prototype.buildPdfReaderPath=function(e){var t=e.replace(/^\//,"").replace(/\.pdf$/i,"");return"/leer-pdf/".concat(t)},o.prototype.popularNovels=function(r,i){return e(this,arguments,void 0,(function(e,r){var i,o,a,l,s,c,u,p=this,d=r.filters;return t(this,(function(t){switch(t.label){case 0:return i=(null===(c=null==d?void 0:d.sortBy)||void 0===c?void 0:c.value)||this.filters.sortBy.value,o=(null===(u=null==d?void 0:d.sortOrder)||void 0===u?void 0:u.value)||this.filters.sortOrder.value,a="".concat(this.apiSite,"/home/explore?page=").concat(e,"&limit=12&sortBy=").concat(i,"&sortOrder=").concat(o),[4,(0,n.fetchApi)(a)];case 1:return[4,t.sent().json()];case 2:return l=t.sent(),s=[],l.data.data.forEach((function(e){var t=e.workImages.find((function(e){return"card"===e.image_type.code&&e.image_url}))||e.workImages.find((function(e){return"cover"===e.image_type.code&&e.image_url})),r=(null==t?void 0:t.image_url)?p.buildCdnUrl(t.image_url):void 0;s.push({name:e.title,cover:r,path:"/obras/".concat(e.id,"-").concat(e.slug)})})),[2,s]}}))}))},o.prototype.parseNovel=function(i){return e(this,void 0,void 0,(function(){var e,o,a,l,s,c,u,p,d,h,f,v,m,b,g,y,w,x,_,I,k,j,A,P,S,U,F,N,O,C,B;return t(this,(function(t){switch(t.label){case 0:if(!(e=i.split("/").pop()))throw new Error("No se pudo obtener el slug de la novela");return o="".concat(this.apiHomeBase,"/works/").concat(e),[4,(0,n.fetchApi)(o)];case 1:return[4,t.sent().json()];case 2:if(a=t.sent(),l=a.data,s=l.workImages.find((function(e){return"card"===e.image_type.code&&e.image_url}))||l.workImages.find((function(e){return"cover"===e.image_type.code&&e.image_url})),c=(null==s?void 0:s.image_url)?this.buildCdnUrl(s.image_url):void 0,u=(null===(j=l.workGenres)||void 0===j?void 0:j.map((function(e){return e.genre.name})))||[],(null===(A=l.type)||void 0===A?void 0:A.name)&&u.push(l.type.name),p=[],d=0,null===(P=l.volumes)||void 0===P?void 0:P.length)for(h=r([],l.volumes,!0).sort((function(e,t){return e.orderIndex-t.orderIndex})),f=0,v=h;f<v.length;f++)if(m=v[f],(null===(S=m.volumeFile)||void 0===S?void 0:S.fileUrl)&&(d++,p.push({name:"Volumen ".concat(m.displayNumber||m.orderIndex," - ").concat(m.title),path:this.buildPdfReaderPath(m.volumeFile.fileUrl),chapterNumber:d})),null===(U=m.chapters)||void 0===U?void 0:U.length)for(y=r([],m.chapters,!0).sort((function(e,t){return e.orderIndex-t.orderIndex})),b=0,g=y;b<g.length;b++)_=g[b],d++,(null===(F=_.chapterFile)||void 0===F?void 0:F.fileUrl)?p.push({name:_.title,path:this.buildPdfReaderPath(_.chapterFile.fileUrl),chapterNumber:d}):p.push({name:_.title,path:"/capitulo/".concat(_.id).concat(_.slug?"-"+_.slug:""),chapterNumber:d});if(null===(N=l.chapters)||void 0===N?void 0:N.length)for(y=r([],l.chapters,!0).sort((function(e,t){return e.orderIndex-t.orderIndex})),w=0,x=y;w<x.length;w++)_=x[w],d++,(null===(O=_.chapterFile)||void 0===O?void 0:O.fileUrl)?p.push({name:_.title,path:this.buildPdfReaderPath(_.chapterFile.fileUrl),chapterNumber:d}):p.push({name:_.title,path:"/capitulo/".concat(_.id).concat(_.slug?"-"+_.slug:""),chapterNumber:d});return I=p.some((function(e){return e.path.startsWith("/leer-pdf/")})),k=I?"".concat(l.synopsis,"\n\nEste título contiene volúmenes/capítulos en PDF."):l.synopsis,[2,{path:i,name:l.title,cover:c,summary:k,status:null===(B=null===(C=l.publicationStatus)||void 0===C?void 0:C.name)||void 0===B?void 0:B.trim(),genres:u.join(", "),chapters:p}]}}))}))},o.prototype.parseChapter=function(r){return e(this,void 0,void 0,(function(){var e,i,o,a,l,s;return t(this,(function(t){switch(t.label){case 0:if(r.startsWith("/leer-pdf/"))return e="/"+r.slice(10)+".pdf",i=this.buildCdnUrl(e),[2,'<div style="text-align:center;padding:32px 16px;font-family:sans-serif;"><p style="font-size:18px;margin-bottom:24px;">Este capítulo está en formato PDF.</p>'+'<a href="'.concat(i,'" style="display:inline-block;padding:14px 28px;')+'background:#1976D2;color:#fff;text-decoration:none;border-radius:8px;font-size:16px;">Abrir PDF</a></div>'];if(!(o=null===(s=null===(l=r.split("/").pop())||void 0===l?void 0:l.match(/^(\d+)/))||void 0===s?void 0:s[1]))throw new Error("No se pudo obtener el ID del capítulo");return a="".concat(this.apiSite,"/home/chapter/").concat(o),[4,(0,n.fetchApi)(a)];case 1:return[4,t.sent().json()];case 2:return[2,t.sent().data.content]}}))}))},o.prototype.searchNovels=function(r,i){return e(this,void 0,void 0,(function(){var e,o,a,l,s,c=this;return t(this,(function(t){switch(t.label){case 0:return e=this.filters.sortBy.value,o=this.filters.sortOrder.value,a="".concat(this.apiSite,"/home/explore?page=").concat(i,"&limit=12&sortBy=").concat(e,"&sortOrder=").concat(o,"&search=").concat(encodeURIComponent(r)),[4,(0,n.fetchApi)(a)];case 1:return[4,t.sent().json()];case 2:return l=t.sent(),s=[],l.data.data.forEach((function(e){var t=e.workImages.find((function(e){return"card"===e.image_type.code&&e.image_url}))||e.workImages.find((function(e){return"cover"===e.image_type.code&&e.image_url})),r=(null==t?void 0:t.image_url)?c.buildCdnUrl(t.image_url):void 0;s.push({name:e.title,cover:r,path:"/obras/".concat(e.id,"-").concat(e.slug)})})),[2,s]}}))}))},o}();exports.default=new o;