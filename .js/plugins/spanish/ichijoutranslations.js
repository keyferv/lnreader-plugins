var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function l(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,l)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){i.label=l[1];break}if(6===l[0]&&i.label<o[1]){i.label=o[1],o=l;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(l);break}o[2]&&i.ops.pop(),i.trys.pop();continue}l=e.call(t,i)}catch(t){l=[6,t],n=0}finally{r=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},r=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("@libs/fetch"),o=require("@libs/filterInputs"),i=function(){function i(){this.id="ichijoutranslations",this.name="Ichijou Translations",this.site="https://www.ichijoutranslations.com",this.apiSite="https://api.ichijoutranslations.com/api",this.apiRoot="https://api.ichijoutranslations.com",this.cdnSite="https://cdn.ichijoutranslations.com",this.apiHomeBase="https://api.ichijoutranslations.com/api/home",this.version="1.1.4",this.icon="src/es/ichijoutranslations/icon.png",this.lang="Spanish",this.filters={sortBy:{type:o.FilterTypes.Picker,label:"Ordenar por",value:"title",options:[{label:"Título",value:"title"},{label:"Agregado",value:"createdAt"},{label:"Actualizado",value:"updatedAt"},{label:"Vistas",value:"views"}]},sortOrder:{type:o.FilterTypes.Picker,label:"Orden",value:"ASC",options:[{label:"Ascendente",value:"ASC"},{label:"Descendente",value:"DESC"}]}}}return i.prototype.buildCdnUrl=function(t){return t.startsWith("http")?t:this.cdnSite+(t.startsWith("/")?t:"/".concat(t))},i.prototype.buildPdfReaderPath=function(t){var e=this.normalizeApiPath(t);return e.startsWith("/leer-pdf/")?e:"/leer-pdf".concat(e)},i.prototype.normalizeApiPath=function(t){var e=t.replace(/^https?:\/\/[^/]+/i,"");return e.startsWith("/")?e:"/".concat(e)},i.prototype.isPdfFile=function(t){return/\.pdf(\?|$)/i.test(t)},i.prototype.buildChapterPdfPath=function(t){var e=this.normalizeApiPath(t),r=e.split("?"),n=r[0],o=r[1],i=n.split("/").pop();if(!i)return this.buildPdfReaderPath(e);var a=o?"?".concat(o):"";return"/leer-pdf/chapter-files/".concat(i).concat(a)},i.prototype.popularNovels=function(r,o){return t(this,arguments,void 0,(function(t,r){var o,i,a,l,c,s,u,p=this,d=r.filters;return e(this,(function(e){switch(e.label){case 0:return o=(null===(s=null==d?void 0:d.sortBy)||void 0===s?void 0:s.value)||this.filters.sortBy.value,i=(null===(u=null==d?void 0:d.sortOrder)||void 0===u?void 0:u.value)||this.filters.sortOrder.value,a="".concat(this.apiSite,"/home/explore?page=").concat(t,"&limit=12&sortBy=").concat(o,"&sortOrder=").concat(i),[4,(0,n.fetchApi)(a)];case 1:return[4,e.sent().json()];case 2:return l=e.sent(),c=[],l.data.data.forEach((function(t){var e=t.workImages.find((function(t){return"card"===t.image_type.code&&t.image_url}))||t.workImages.find((function(t){return"cover"===t.image_type.code&&t.image_url})),r=(null==e?void 0:e.image_url)?p.buildCdnUrl(e.image_url):void 0;c.push({name:t.title,cover:r,path:"/obras/".concat(t.id,"-").concat(t.slug)})})),[2,c]}}))}))},i.prototype.parseNovel=function(o){return t(this,void 0,void 0,(function(){var t,i,a,l,c,s,u,p,d,h,f,v,m,y,b,g,w,x,A,P,_,j,I,k,S;return e(this,(function(e){switch(e.label){case 0:if(!(t=o.split("/").pop()))throw new Error("No se pudo obtener el slug de la novela");return i="".concat(this.apiHomeBase,"/works/").concat(t),[4,(0,n.fetchApi)(i)];case 1:return[4,e.sent().json()];case 2:if(a=e.sent(),l=a.data,c=l.coverUrl?this.buildCdnUrl(l.coverUrl):void 0,s=(null===(_=l.workGenres)||void 0===_?void 0:_.map((function(t){return t.genre.name})))||[],u=[],p=0,(d=Array.isArray(l.volumes)?l.volumes:[]).length)for(h=r([],d,!0).sort((function(t,e){return t.orderIndex-e.orderIndex})),f=0,v=h;f<v.length;f++)m=v[f],(A=m.fileUrl||(null===(j=m.volumeFile)||void 0===j?void 0:j.fileUrl))&&this.isPdfFile(A)&&(p++,u.push({name:"Volumen ".concat(m.orderIndex,": ").concat(m.title),path:this.buildPdfReaderPath(A),releaseTime:m.createdAt,chapterNumber:p}));if((y=Array.isArray(l.chapters)?l.chapters:[]).length)for(b=r([],y,!0).sort((function(t,e){return t.orderIndex-e.orderIndex})),g=0,w=b;g<w.length;g++)x=w[g],p++,A=x.fileUrl||(null===(I=x.chapterFile)||void 0===I?void 0:I.fileUrl),P=A&&this.isPdfFile(A)?this.buildChapterPdfPath(A):null,u.push({name:"Capítulo ".concat(x.orderIndex,": ").concat(x.title),path:null!=P?P:"/capitulo/".concat(x.id),releaseTime:x.createdAt,chapterNumber:p});return[2,{path:o,name:l.title,cover:c,summary:l.synopsis,status:null===(S=null===(k=l.publicationStatus)||void 0===k?void 0:k.name)||void 0===S?void 0:S.trim(),genres:s.join(", "),chapters:u}]}}))}))},i.prototype.parseChapter=function(r){return t(this,void 0,void 0,(function(){var t,o,i,a,l,c,s,u,p,d,h,f,v,m,y,b,g;return e(this,(function(e){switch(e.label){case 0:return r.includes("/leer-pdf/")?(t=r.replace("/leer-pdf",""),o="".concat(this.apiRoot).concat(t),[2,'<div style="text-align:center;padding:32px 16px;font-family:sans-serif;"><p style="font-size:18px;margin-bottom:24px;">Este capítulo está en formato PDF.</p>'+'<a href="'.concat(o,'" style="display:inline-block;padding:14px 28px;')+'background:#1976D2;color:#fff;text-decoration:none;border-radius:8px;font-size:16px;">Abrir PDF</a></div>']):r.startsWith("/capitulo/")?(i="".concat(this.apiSite,"/home").concat(r),[4,(0,n.fetchApi)(i)]):[3,3];case 1:return[4,e.sent().json()];case 2:if(a=e.sent(),!(l=null!==(f=null!==(h=null===(d=a.data)||void 0===d?void 0:d.content)&&void 0!==h?h:a.content)&&void 0!==f?f:""))throw new Error("No se encontró contenido del capítulo");return[2,l];case 3:if(!(c=null===(m=null===(v=r.split("/").pop())||void 0===v?void 0:v.match(/^(\d+)/))||void 0===m?void 0:m[1]))throw new Error("No se pudo obtener el ID del capítulo");return s="".concat(this.apiSite,"/home/chapter/").concat(c),[4,(0,n.fetchApi)(s)];case 4:return[4,e.sent().json()];case 5:if(u=e.sent(),!(p=null!==(g=null!==(b=null===(y=u.data)||void 0===y?void 0:y.content)&&void 0!==b?b:u.content)&&void 0!==g?g:""))throw new Error("No se encontró contenido del capítulo");return[2,p]}}))}))},i.prototype.searchNovels=function(r,o){return t(this,void 0,void 0,(function(){var t,i,a,l,c,s=this;return e(this,(function(e){switch(e.label){case 0:return t=this.filters.sortBy.value,i=this.filters.sortOrder.value,a="".concat(this.apiSite,"/home/explore?page=").concat(o,"&limit=12&sortBy=").concat(t,"&sortOrder=").concat(i,"&search=").concat(encodeURIComponent(r)),[4,(0,n.fetchApi)(a)];case 1:return[4,e.sent().json()];case 2:return l=e.sent(),c=[],l.data.data.forEach((function(t){var e=t.workImages.find((function(t){return"card"===t.image_type.code&&t.image_url}))||t.workImages.find((function(t){return"cover"===t.image_type.code&&t.image_url})),r=(null==e?void 0:e.image_url)?s.buildCdnUrl(e.image_url):void 0;c.push({name:t.title,cover:r,path:"/obras/".concat(t.id,"-").concat(t.slug)})})),[2,c]}}))}))},i}();exports.default=new i;