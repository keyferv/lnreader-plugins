var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function o(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),n=require("@libs/defaultCover"),a=require("@libs/fetch"),i=function(t){return new Promise((function(e){return setTimeout(e,t)}))},s=function(){function s(){this.id="DevilNovels",this.name="DevilNovels",this.icon="src/es/devilnovels/icon.png",this.site="https://devilnovels.com/",this.version="1.0.3",this.filters={}}return s.prototype.popularNovels=function(s,o){return t(this,arguments,void 0,(function(t,s){var o,c,l,u,f,p,h,d,m,v,y,b=this;s.filters;return e(this,(function(e){switch(e.label){case 0:return o=[],c=this.site+"listado-de-novelas/",[4,(0,a.fetchApi)(c)];case 1:return(l=e.sent()).ok?[4,l.text()]:[2,o];case 2:return u=e.sent(),f=(0,r.load)(u),p=new Map,f(".pvc-featured-pages-grid .pvc-featured-page-item").each((function(t,e){var r=f(e),a=r.find("a").first(),i=a.attr("href")||"",s=r.find("img").attr("src")||n.defaultCover,o=r.find("p.pvc-page-title a").text().trim()||a.attr("title")||a.text().trim(),c=i.replace(b.site,"");o&&p.set(c||i,{name:o,path:c,cover:s})})),f("p.pvc-page-title a").each((function(t,e){var r=f(e),a=r.attr("href")||"",i=r.text().trim(),s=r.closest(".pvc-featured-page-item"),o=s&&s.length&&s.find("img").attr("src")||n.defaultCover,c=a.replace(b.site,"");i&&p.set(c||a,{name:i,path:c,cover:o})})),f("table tbody tr").each((function(t,e){var r=f(e).find("td");if(!(r.length<1)){var a,i=r.first(),s=r.eq(1),o=i.find("a").first(),c=o.attr("href")||"",l=o.text().trim(),u=i.find("img").attr("src")||n.defaultCover,h=c.replace(b.site,"");if(s&&s.length){var d=s.find("a").first(),m=d.attr("href")||"",v=d.text().trim();v&&(a={name:v,path:m.replace(b.site,"")})}l&&p.set(h||c,{name:l,path:h,cover:u,latestChapter:a})}})),h=Array.from(p.values()),d=Math.max(1,t||1),v=(m=10*(d-1))+10,y=h.slice(m,v),[4,i(600)];case 3:return e.sent(),[2,y]}}))}))},s.prototype.parseNovel=function(s){return t(this,void 0,void 0,(function(){var t,o,c,l,u,f,p,h,d,m,v,y,b,g,x,w,_=this;return e(this,(function(k){switch(k.label){case 0:return t=s.startsWith("http")?s:this.site+s,[4,(0,a.fetchApi)(t)];case 1:return[4,k.sent().text()];case 2:o=k.sent(),c=(0,r.load)(o),l={path:s,name:c('meta[property="og:title"]').attr("content")||c("h1").first().text().trim()||"",cover:c('meta[property="og:image"]').attr("content")||n.defaultCover,summary:void 0,chapters:[]},(u=c(".entry-content").first())&&u.length&&((f=u.clone()).find('.elementor-posts-container, .elementor-posts, .elementor-post, .elementor-pagination, .code-block, iframe, script, style, .ad, .adsbygoogle, .post-list, .chapter-list, [data-id="c7ecb4a"], .elementor-element-c7ecb4a').remove(),f.find('[class*="ad-"]').remove(),(p=f.text().trim())?l.summary=p:(h=u.find("p").filter((function(t,e){return c(e).text().trim()})).first())&&h.length&&(l.summary=h.text().trim())),d=new Set,c(".entry-content a, .post a").each((function(t,e){var r=c(e),n=r.attr("href")||"",a=r.text().trim();if(n&&a&&/chapter|capitulo|cap|act/i.test(n)){var i=n.replace(_.site,"");d.has(i)||(d.add(i),l.chapters.push({name:a,path:i}))}})),c(".elementor-posts-container article, .elementor-post").each((function(t,e){var r=c(e).find('h3.elementor-post__title a, h3.elementor-post__title > a, a[data-wpel-link="internal"]').first(),n=r.attr("href")||"",a=r.text().trim();if(n&&a){var i=n.replace(_.site,"");d.has(i)||(d.add(i),l.chapters.push({name:a,path:i}))}})),m=c(".elementor-pagination a.page-numbers").map((function(t,e){return c(e).attr("href")||""})).get().filter((function(t){return!!t})),v=Array.from(new Set(m)),y=function(n){var o,c,u,f,p;return e(this,(function(e){switch(e.label){case 0:if(!(o=n.replace(/#.*$/,"")))return[2,"continue"];if(o===t||o===b.site+s)return[2,"continue"];e.label=1;case 1:return e.trys.push([1,5,,6]),c=o.startsWith("http")?o:b.site+o.replace(/^\//,""),[4,(0,a.fetchApi)(c)];case 2:return(u=e.sent()).ok?[4,u.text()]:[2,"continue"];case 3:return f=e.sent(),(p=(0,r.load)(f))(".elementor-posts-container article, .elementor-post").each((function(t,e){var r=p(e).find('h3.elementor-post__title a, h3.elementor-post__title > a, a[data-wpel-link="internal"]').first(),n=r.attr("href")||"",a=r.text().trim();if(n&&a){var i=n.replace(_.site,"");d.has(i)||(d.add(i),l.chapters.push({name:a,path:i}))}})),[4,i(300)];case 4:return e.sent(),[3,6];case 5:return e.sent(),[2,"continue"];case 6:return[2]}}))},b=this,g=0,x=v,k.label=3;case 3:return g<x.length?(w=x[g],[5,y(w)]):[3,6];case 4:k.sent(),k.label=5;case 5:return g++,[3,3];case 6:return[2,l]}}))}))},s.prototype.parseChapter=function(n){return t(this,void 0,void 0,(function(){var t,i,s;return e(this,(function(e){switch(e.label){case 0:return t=n.startsWith("http")?n:this.site+n,[4,(0,a.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return i=e.sent(),s=(0,r.load)(i),[2,s(".entry-content").first().html()||s("article").first().html()||""]}}))}))},s.prototype.searchNovels=function(i,s){return t(this,void 0,void 0,(function(){var t,o,c,l,u,f,p=this;return e(this,(function(e){switch(e.label){case 0:return t=[],o=s&&s>1?"&paged=".concat(s):"",c="".concat(this.site,"?post_type=page&s=").concat(encodeURIComponent(i)).concat(o),[4,(0,a.fetchApi)(c)];case 1:return(l=e.sent()).ok?[4,l.text()]:[2,t];case 2:return u=e.sent(),(f=(0,r.load)(u))(".ast-article-inner").each((function(e,r){var a=f(r),i=a.find("h2.entry-title a").first(),s=i.attr("href")||"",o=i.text().trim(),c=a.find(".post-thumb img").attr("src")||n.defaultCover,l=s.replace(p.site,"");o&&t.push({name:o,path:l,cover:c})})),[2,t]}}))}))},s}();exports.default=new s;