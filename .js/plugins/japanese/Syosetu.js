var e,t=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)},function(r){if(r&&r.__esModule)return r;var a={};if(null!=r)for(var l=e(r),i=0;i<l.length;i++)"default"!==l[i]&&t(a,r,l[i]);return n(a,r),a}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,l){function i(e){try{u(r.next(e))}catch(e){l(e)}}function o(e){try{u(r.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var n,r,a,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(l=0)),l;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(a=l.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){l.label=o[1];break}if(6===o[0]&&l.label<a[1]){l.label=a[1],a=o;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(o);break}a[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var i=r(require("cheerio")).load,o=require("@libs/fetch"),u=require("@libs/defaultCover"),c=require("@libs/filterInputs"),s=require("@libs/novelStatus"),h=function(){function e(){var e=this;this.id="yomou.syosetu",this.name="Syosetu",this.icon="src/jp/syosetu/icon.png",this.site="https://yomou.syosetu.com/",this.novelPrefix="https://ncode.syosetu.com",this.version="1.1.2",this.lang="Japanese",this.headers={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"},this.searchUrl=function(t,n){return"".concat(e.site,"search.php?order=").concat(n||"hyoka").concat(void 0!==t?"&p=".concat(t<=1||t>100?"1":t):"")},this.filters={ranking:{type:c.FilterTypes.Picker,label:"Ranked by",options:[{label:"日間",value:"daily"},{label:"週間",value:"weekly"},{label:"月間",value:"monthly"},{label:"四半期",value:"quarter"},{label:"年間",value:"yearly"},{label:"累計",value:"total"}],value:"total"},genre:{type:c.FilterTypes.Picker,label:"Ranking Genre",options:[{label:"総ジャンル",value:""},{label:"異世界転生/転移〔恋愛〕〕",value:"1"},{label:"異世界転生/転移〔ファンタジー〕",value:"2"},{label:"異世界転生/転移〔文芸・SF・その他〕",value:"o"},{label:"異世界〔恋愛〕",value:"101"},{label:"現実世界〔恋愛〕",value:"102"},{label:"ハイファンタジー〔ファンタジー〕",value:"201"},{label:"ローファンタジー〔ファンタジー〕",value:"202"},{label:"純文学〔文芸〕",value:"301"},{label:"ヒューマンドラマ〔文芸〕",value:"302"},{label:"歴史〔文芸〕",value:"303"},{label:"推理〔文芸〕",value:"304"},{label:"ホラー〔文芸〕",value:"305"},{label:"アクション〔文芸〕",value:"306"},{label:"コメディー〔文芸〕",value:"307"},{label:"VRゲーム〔SF〕",value:"401"},{label:"宇宙〔SF〕",value:"402"},{label:"空想科学〔SF〕",value:"403"},{label:"パニック〔SF〕",value:"404"},{label:"童話〔その他〕",value:"9901"},{label:"詩〔その他〕",value:"9902"},{label:"エッセイ〔その他〕",value:"9903"},{label:"その他〔その他〕",value:"9999"}],value:""},modifier:{type:c.FilterTypes.Picker,label:"Modifier",options:[{label:"すべて",value:"total"},{label:"連載中",value:"r"},{label:"完結済",value:"er"},{label:"短編",value:"t"}],value:"total"}}}return e.prototype.popularNovels=function(e,t){return a(this,arguments,void 0,(function(e,t){var n,r=this,c=t.filters;return l(this,(function(t){switch(t.label){case 0:return n=function(e){return a(r,void 0,void 0,(function(){var t,n,r,a,s=this;return l(this,(function(l){switch(l.label){case 0:return t=this.site,c.genre.value?t+="rank/".concat(1===c.genre.value.length?"isekailist":"genrelist","/type/").concat(c.ranking.value,"_").concat(c.genre.value).concat("total"===c.modifier.value?"":"_".concat(c.modifier.value),"/?p=").concat(e):t+="rank/list/type/".concat(c.ranking.value,"_").concat(c.modifier.value,"/?p=").concat(e),[4,(0,o.fetchApi)(t)];case 1:return[4,l.sent().text()];case 2:return n=l.sent(),r=i(n,{decodeEntities:!1}),parseInt(r(".is-current").html()||"1")!==e?[2,[]]:(a=[],r(".c-card").each((function(e,t){var n=r(t).find(".p-ranklist-item__title a"),l=n.attr("href");if(l){var i=n.text(),o={path:l.replace(s.novelPrefix,""),name:i,cover:u.defaultCover};a.push(o)}})),[2,a])}}))}))},[4,n(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.parseChaptersFromPage=function(e){return a(this,void 0,void 0,(function(){var t,n=this;return l(this,(function(r){return t=[],e(".p-eplist__sublist").each((function(r,a){var l=e(a).find("a"),i=l.attr("href"),o=l.text().trim(),u=e(a).find(".p-eplist__update").text().trim().split(" ")[0].replace(/\//g,"-");i&&t.push({name:o,releaseTime:u,path:i.replace(n.novelPrefix,"")})})),[2,t]}))}))},e.prototype.parseNovel=function(e){return a(this,void 0,void 0,(function(){var t,n,r,a,c,h,p,f,v,d,b=this;return l(this,(function(l){switch(l.label){case 0:return[4,(0,o.fetchApi)(this.novelPrefix+e,{headers:this.headers})];case 1:return[4,l.sent().text()];case 2:return t=l.sent(),n=i(t,{decodeEntities:!1}),r="Unknown",n(".c-announce").text().includes("連載中")||n(".c-announce").text().includes("未完結")?r=s.NovelStatus.Ongoing:n(".c-announce").text().includes("更新されていません")?r=s.NovelStatus.OnHiatus:n(".c-announce").text().includes("完結")&&(r=s.NovelStatus.Completed),(a={path:e,name:n(".p-novel__title").text(),author:n(".p-novel__author").text().replace("作者：","").trim(),status:r,artist:"",cover:u.defaultCover,chapters:[],genres:null===(d=n('meta[property="og:description"]').attr("content"))||void 0===d?void 0:d.split(" ").join(",")}).summary=n("#novel_ex").html()||"",c=[],(h=n(".c-pager__item--last").attr("href"))?[3,3]:(n(".p-eplist__sublist").each((function(e,t){var r=n(t).find("a"),a=r.attr("href"),l=r.text().trim(),i=n(t).find(".p-eplist__update").text().trim().split(" ")[0].replace(/\//g,"-");a&&c.push({name:l,releaseTime:i,path:a.replace(b.novelPrefix,"")})})),[3,5]);case 3:return p=h.match(/\?p=(\d+)/),f=p?parseInt(p[1]):1,v=Array.from({length:f},(function(t,n){return(0,o.fetchApi)("".concat(b.novelPrefix).concat(e,"?p=").concat(n+1)).then((function(e){return e.text()}))})),[4,Promise.all(v)];case 4:l.sent().forEach((function(e){var t=i(e,{decodeEntities:!1});t(".p-eplist__sublist").each((function(e,n){var r=t(n).find("a"),a=r.attr("href"),l=r.text().trim(),i=t(n).find(".p-eplist__update").text().trim().split(" ")[0].replace(/\//g,"-");a&&c.push({name:l,releaseTime:i,path:a.replace(b.novelPrefix,"")})}))})),l.label=5;case 5:return a.chapters=c,[2,a]}}))}))},e.prototype.parseChapter=function(e){return a(this,void 0,void 0,(function(){var t,n,r,a;return l(this,(function(l){switch(l.label){case 0:return[4,(0,o.fetchApi)(this.novelPrefix+e,{headers:this.headers})];case 1:return[4,l.sent().text()];case 2:return t=l.sent(),n=i(t,{decodeEntities:!1}),r=n(".p-novel__title").html()||"",a=n('.p-novel__body .p-novel__text:not([class*="p-novel__text--"])').html()||"",[2,"<h1>".concat(r,"</h1>").concat(a)]}}))}))},e.prototype.searchNovels=function(e,t){return a(this,void 0,void 0,(function(){var n,r=this;return l(this,(function(c){switch(c.label){case 0:return n=function(t){return a(r,void 0,void 0,(function(){var n,r,a,c,s=this;return l(this,(function(l){switch(l.label){case 0:return n=this.searchUrl(t)+"&word=".concat(e),[4,(0,o.fetchApi)(n,{headers:this.headers})];case 1:return[4,l.sent().text()];case 2:return r=l.sent(),a=i(r,{decodeEntities:!1}),c=[],a(".searchkekka_box").each((function(e,t){var n=a(t).find(".novel_h"),r=n.children()[0].attribs.href.replace(s.novelPrefix,"");r&&c.push({name:n.text(),path:r,cover:u.defaultCover})})),[2,c]}}))}))},[4,n(t)];case 1:return[2,c.sent()]}}))}))},e.prototype.resolveUrl=function(e){return this.novelPrefix+e},e}();exports.default=new h;